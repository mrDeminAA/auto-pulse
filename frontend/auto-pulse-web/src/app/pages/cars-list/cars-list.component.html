<app-main-layout [breadcrumbs]="breadcrumbs">
  <div class="cars-page">
    <div class="cars-page__header">
      <h1 class="page-title">üöó –ê–≤—Ç–æ–º–æ–±–∏–ª–∏</h1>
      
      <!-- –í–∫–ª–∞–¥–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è (–∑–∞–≥–æ—Ç–æ–≤–∫–∞) -->
      <div class="tabs">
        <button class="tabs__item tabs__item_active" type="button">
          –í—Å–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏
        </button>
        <button class="tabs__item" type="button" disabled title="–°–∫–æ—Ä–æ">
          –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
        </button>
        <button class="tabs__item" type="button" disabled title="–°–∫–æ—Ä–æ">
          –°—Ä–∞–≤–Ω–µ–Ω–∏–µ
        </button>
      </div>
    </div>

    <div class="cars-page__layout">
      <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
      <app-sidebar (search)="onSearch($event)" (reset)="onReset()">
        <div sidebar-filters>
          <!-- –§–∏–ª—å—Ç—Ä –ø–æ –±—Ä–µ–Ω–¥—É -->
          <div class="filter-group">
            <label class="filter-group__label">–ë—Ä–µ–Ω–¥</label>
            <select class="select" [(ngModel)]="selectedBrand" (change)="onFilterChange()">
              <option [ngValue]="null">–í—Å–µ –±—Ä–µ–Ω–¥—ã</option>
              @for (brand of brands; track brand) {
                <option [ngValue]="brand">{{ brand }}</option>
              }
            </select>
          </div>

          <!-- –§–∏–ª—å—Ç—Ä –ø–æ –≥–æ–¥—É (–∑–∞–≥–æ—Ç–æ–≤–∫–∞) -->
          <div class="filter-group">
            <label class="filter-group__label">–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞</label>
            <div class="range-inputs">
              <input type="number" class="input input_small" placeholder="–û—Ç" [(ngModel)]="yearFrom" (change)="onFilterChange()">
              <input type="number" class="input input_small" placeholder="–î–æ" [(ngModel)]="yearTo" (change)="onFilterChange()">
            </div>
          </div>

          <!-- –§–∏–ª—å—Ç—Ä –ø–æ —Ü–µ–Ω–µ (–∑–∞–≥–æ—Ç–æ–≤–∫–∞) -->
          <div class="filter-group">
            <label class="filter-group__label">–¶–µ–Ω–∞, ‚ÇΩ</label>
            <div class="range-inputs">
              <input type="number" class="input input_small" placeholder="–û—Ç" [(ngModel)]="priceFrom" (change)="onFilterChange()">
              <input type="number" class="input input_small" placeholder="–î–æ" [(ngModel)]="priceTo" (change)="onFilterChange()">
            </div>
          </div>

          <!-- –§–∏–ª—å—Ç—Ä –ø–æ –Ω–∞–ª–∏—á–∏—é -->
          <div class="filter-group">
            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="onlyAvailable" (change)="onFilterChange()">
              <span class="checkbox-label__text">–¢–æ–ª—å–∫–æ –≤ –Ω–∞–ª–∏—á–∏–∏</span>
            </label>
          </div>

          <!-- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
          <div class="filter-group">
            <label class="filter-group__label">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>
            <select class="select" [(ngModel)]="sortBy" (change)="onFilterChange()">
              <option value="newest">–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
              <option value="oldest">–°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ</option>
              <option value="price-asc">–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é —Ü–µ–Ω—ã</option>
              <option value="price-desc">–ü–æ —É–±—ã–≤–∞–Ω–∏—é —Ü–µ–Ω—ã</option>
              <option value="year-desc">–ü–æ –≥–æ–¥—É (–Ω–æ–≤—ã–µ)</option>
            </select>
          </div>
        </div>
      </app-sidebar>

      <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
      <div class="cars-page__content">
        <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="content-panel">
          <div class="content-panel__left">
            <!-- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø—Ä–µ–≤—å—é -->
            <div class="sorting-control">
              <button class="sorting-control__button" type="button">
                <span class="sorting-control__text">{{ getSortLabel() }}</span>
              </button>
            </div>
            
            <!-- –ü–µ—Ä–∏–æ–¥ (–∑–∞–≥–æ—Ç–æ–≤–∫–∞) -->
            <select class="select select_period">
              <option value="all">–ó–∞ –≤—Å–µ –≤—Ä–µ–º—è</option>
              <option value="day">–ó–∞ —Å—É—Ç–∫–∏</option>
              <option value="3days">–ó–∞ 3 –¥–Ω—è</option>
              <option value="week">–ó–∞ –Ω–µ–¥–µ–ª—é</option>
              <option value="month">–ó–∞ –º–µ—Å—è—Ü</option>
            </select>
          </div>
          
          <div class="content-panel__right">
            <span class="results-counter">–ù–∞–π–¥–µ–Ω–æ <strong>{{ totalCount() }}</strong> –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π</span>
            
            <!-- –ö–Ω–æ–ø–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö -->
            <button class="button button_icon button_secondary" type="button" (click)="toggleMobileFilters()">
              <svg class="icon">
                <use xlink:href="#filter"></use>
              </svg>
            </button>
          </div>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π -->
        @if (loading()) {
          <div class="loading-block">
            <div class="spinner"></div>
            <p class="loading-block__text">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
          </div>
        } @else if (error()) {
          <div class="error-block">
            <svg class="icon icon_l">
              <use xlink:href="#error"></use>
            </svg>
            <p class="error-block__text">{{ error() }}</p>
          </div>
        } @else if (cars().length === 0) {
          <div class="empty-block">
            <svg class="icon icon_l">
              <use xlink:href="#search"></use>
            </svg>
            <h3 class="empty-block__title">–ê–≤—Ç–æ–º–æ–±–∏–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
            <p class="empty-block__text">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</p>
          </div>
        } @else {
          <div class="cars-list">
            @for (car of cars(); track trackByCarId($index, car)) {
              <article class="car-card car-card_{{ car.isAvailable ? 'available' : 'unavailable' }}">
                <div class="car-card__wrapper">
                  <strong class="car-card__name">
                    <span class="content_visually-hidden">–ê–≤—Ç–æ–º–æ–±–∏–ª—å:</span>
                    {{ car.brandName }} {{ car.modelName }}
                  </strong>
                  
                  <!-- –ò–∑–±—Ä–∞–Ω–Ω–æ–µ (–∑–∞–≥–æ—Ç–æ–≤–∫–∞) -->
                  <span class="car-card__favorite" title="–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ">
                    <label class="button-switch">
                      <input type="checkbox" class="button-switch__control" disabled>
                      <svg class="icon button-switch__icon">
                        <use xlink:href="#heart"></use>
                      </svg>
                    </label>
                  </span>
                </div>

                <div class="car-card__details">
                  <div class="car-card__detail-row">
                    <span class="car-card__year">
                      <svg class="icon icon_s">
                        <use xlink:href="#calendar"></use>
                      </svg>
                      {{ car.year }} –≥–æ–¥
                    </span>
                    <span class="car-card__mileage" *ngIf="car.mileage">
                      <svg class="icon icon_s">
                        <use xlink:href="#mileage"></use>
                      </svg>
                      {{ car.mileage | number }} –∫–º
                    </span>
                  </div>
                  
                  <div class="car-card__price">
                    –æ—Ç {{ car.price | number }} {{ car.currency }}
                  </div>
                </div>

                <div class="car-card__footer">
                  <div class="car-card__status">
                    @if (car.isAvailable) {
                      <span class="status-badge status-badge_success">
                        <svg class="icon icon_s">
                          <use xlink:href="#check"></use>
                        </svg>
                        –í –Ω–∞–ª–∏—á–∏–∏
                      </span>
                    } @else {
                      <span class="status-badge status-badge_danger">
                        <svg class="icon icon_s">
                          <use xlink:href="#close"></use>
                        </svg>
                        –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏
                      </span>
                    }
                  </div>
                  
                  <div class="car-card__actions">
                    <span class="car-card__date">
                      –û–±–Ω–æ–≤–ª–µ–Ω–æ: {{ car.createdAt | date:'dd.MM.yyyy' }}
                    </span>
                    
                    <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ -->
                    <button class="button button_icon button_plain" 
                            title="–û—Ç–∫—Ä—ã—Ç—å –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ"
                            disabled
                            title="–°–∫–æ—Ä–æ">
                      <svg class="icon">
                        <use xlink:href="#tab"></use>
                      </svg>
                    </button>
                  </div>
                </div>
              </article>
            }
          </div>

          <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è (–∑–∞–≥–æ—Ç–æ–≤–∫–∞) -->
          @if (totalCount() > 20) {
            <div class="pagination-block">
              <button class="button button_secondary" type="button">
                –ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â—ë
              </button>
            </div>
          }
        }
      </div>
    </div>
  </div>
</app-main-layout>
